<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>用户注册</title>
    <!-- plugins:css -->
    <link
      rel="stylesheet"
      href="majestic/vendors/mdi/css/materialdesignicons.min.css"
    />
    <link
      rel="stylesheet"
      href="majestic/vendors/base/vendor.bundle.base.css"
    />
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="majestic/css/style.css" />
    <!-- endinject -->
    <link rel="shortcut icon" href="majestic/images/favicon.png" />
    <script src="js/sweetalert2@11.js"></script>
  </head>

  <body>
    <div class="container-scroller">
      <div class="container-fluid page-body-wrapper full-page-wrapper">
        <div class="content-wrapper d-flex align-items-center auth px-0">
          <div class="row w-100 mx-0">
            <div class="col-lg-4 mx-auto">
              <div class="auth-form-light text-left py-5 px-4 px-sm-5">
                <div class="brand-logo">
                  <img src="majestic/images/logo.svg" alt="logo" />
                </div>
                <h4>新用户?</h4>
                <h6 class="font-weight-light">仅需简单几步即可成功注册</h6>
                <form class="pt-3" id="registerForm">
                  <div class="form-group">
                    <input
                      type="text"
                      class="form-control form-control-lg"
                      id="exampleInputUsername1"
                      placeholder="用户名"
                    />
                  </div>
                  <div class="form-group">
                    <input
                      type="email"
                      class="form-control form-control-lg"
                      id="exampleInputEmail1"
                      placeholder="邮箱"
                    />
                    <button
                      id="emailCaptchaBtn"
                      style="margin-top: 5%"
                      class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn"
                    >
                      获取验证码
                    </button>
                  </div>
                  <div class="form-group">
                    <input
                      type="text"
                      class="form-control form-control-lg"
                      id="emailCaptchaCode"
                      placeholder="验证码"
                    />
                  </div>
                  <div class="form-group">
                    <input
                      type="password"
                      class="form-control form-control-lg"
                      id="exampleInputPassword1"
                      placeholder="密码"
                    />
                  </div>
                  <div class="mb-4">
                    <div class="form-check">
                      <div>
                        <label class="form-check-label text-muted">
                          <input
                            type="checkbox"
                            class="form-check-input"
                          />我同意《新用户注册协议》</label
                        ><a href="/policy">点击查看</a>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3">
                    <button
                      type="submit"
                      class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn"
                    >
                      注册
                    </button>
                  </div>
                  <div class="text-center mt-4 font-weight-light">
                    已有帐户? <a href="login" class="text-primary">登录</a>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="majestic/vendors/base/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- inject:js -->
    <script src="majestic/js/off-canvas.js"></script>
    <script src="majestic/js/hoverable-collapse.js"></script>
    <script src="majestic/js/template.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script>
      $(document).ready(function () {
        // 获取验证码
        $("#emailCaptchaBtn").click(function (event) {
          event.preventDefault();
          var email = $("#exampleInputEmail1").val();
          $.ajax({
            type: "POST",
            url: "/service/emailCode",
            data: { email: email },
            success: function (response) {
              Swal.fire({
                title: "验证码已发送",
                text: response.message,
                icon: "success",
                confirmButtonText: "OK",
              });
            },
            error: function (xhr, status, error) {
              Swal.fire({
                title: "发送验证码失败!",
                text: "发生错误: " + error,
                icon: "error",
                confirmButtonText: "OK",
              });
            },
          });
        });

        // 注册用户
        $("#registerForm").submit(function (event) {
          event.preventDefault();
          var username = $("#exampleInputUsername1").val();
          var email = $("#exampleInputEmail1").val();
          var captchaCode = $("#emailCaptchaCode").val();
          var password = $("#exampleInputPassword1").val();
          $.ajax({
            type: "POST",
            url: "/service/register",
            data: {
              username: username,
              email: email,
              captchaCode: captchaCode,
              password: password,
            },
            success: function (response) {
              var status = response;
              console.log(status);
              if (status == 1) {
                Swal.fire({
                  title: "注册成功!",
                  icon: "success",
                  confirmButtonText: "OK",
                }).then(function () {
                  window.location.href = "/login";
                });
              } else if (status == 2) {
                Swal.fire({
                  title: "验证码错误!",
                  text: response.message,
                  icon: "error",
                  confirmButtonText: "OK",
                })
              } else if (status == 0) {
                Swal.fire({
                  title: "其他错误!",
                  text: response.message,
                  icon: "error",
                  confirmButtonText: "OK",
                })
              } else {
                Swal.fire({
                  title: "未知错误!",
                  text: response.message,
                  icon: "error",
                  confirmButtonText: "OK",
                })
              }
            },
            error: function (xhr, status, error) {
              Swal.fire({
                title: "注册失败!",
                text: "发生错误: " + error,
                icon: "error",
                confirmButtonText: "OK",
              });
            },
          });
        });
      });
    </script>
    <!-- End custom js for this page-->
  </body>
</html>
